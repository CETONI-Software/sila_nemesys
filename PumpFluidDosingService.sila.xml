<?xml version="1.0" encoding="utf-8" ?>
<Feature SiLA2Version="0.1" FeatureVersion="1.0" Originator="de.cetoni" Category="pumps.syringepumps" xmlns="http://www.sila-standard.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sila-standard.org https://gitlab.com/SiLA2/sila_features/raw/master/schema/FeatureDefinition.xsd">
    <Identifier>PumpFluidDosingService</Identifier>
    <DisplayName>Pump Fluid Dosing Service</DisplayName>
    <Description>
        Allows to dose a specified fluid. There are commands for absolute dosing (SetFillLevel) and relative dosing (StartDoseVolume and StartGenerateFlow) available.

        The flow rate can be negative. In this case the pump aspirates the fluid instead of dispensing. The flow rate has to be a value between MaxFlowRate and MinFlowRate. If the value is not within this range (hence is invalid) the ValidationError FlowRateOutOfRange is thrown.
        At any time the property CurrentSyringeFillLevel can be queried to see how much fluid is left in the syringe. Similarly the property CurrentFlowRate can be queried to get the current flow rate at which the pump is dosing.
    </Description>

    <!-- Commands -->
    <Command>
        <Identifier>SetFillLevel</Identifier>
        <DisplayName>Set Fill Level</DisplayName>
        <Description>
                Pumps fluid with the given flow rate until the requested fill level is reached.
                Depending on the requested fill level given in the FillLevel parameter this function may cause aspiration or dispension of fluid.
        </Description>
        <Observable>Yes</Observable>
        <Parameter>
            <Identifier>FillLevel</Identifier>
            <DisplayName>Fill Level</DisplayName>
            <Description>
                The requested fill level. A level of 0 indicates a completely empty syringe. The value has to be between 0 and MaxSyringeFillLevel or else the ValidationError RequestedFillLevelOutOfRange is thrown.
            </Description>
            <DataType>
                <DataTypeIdentifier>ValueWithUnit</DataTypeIdentifier>
            </DataType>
        </Parameter>
        <Parameter>
            <Identifier>FlowRate</Identifier>
            <DisplayName>Flow Rate</DisplayName>
            <Description>
                    The flow rate at which the pump should dose the fluid. This value can be negative. In that case the pump aspirates the fluid.
            </Description>
            <DataType>
                <DataTypeIdentifier>ValueWithUnit</DataTypeIdentifier>
            </DataType>
        </Parameter>
        <Response>
            <Identifier>Success</Identifier>
            <DisplayName>Success</DisplayName>
            <Description>A boolean value where false means that the dosage failed and true meaning the dosage was finished properly.</Description>
            <DataType>
                <Basic>Boolean</Basic>
            </DataType>
        </Response>
        <StandardExecutionErrors>
            <StandardExecutionErrorIdentifier>DosageFinishedUnexpectedly</StandardExecutionErrorIdentifier>
        </StandardExecutionErrors>
    </Command>
    <Command>
        <Identifier>DoseVolume</Identifier>
        <DisplayName>Dose Volume</DisplayName>
        <Description>Dose a certain amount of volume with the given flow rate.</Description>
        <Observable>Yes</Observable>
        <Parameter>
            <Identifier>Volume</Identifier>
            <DisplayName>Volume</DisplayName>
            <Description>The amount of volume to dose.</Description>
            <DataType>
                <DataTypeIdentifier>ValueWithUnit</DataTypeIdentifier>
            </DataType>
        </Parameter>
        <Parameter>
            <Identifier>FlowRate</Identifier>
            <DisplayName>Flow Rate</DisplayName>
            <Description>
                The flow rate at which the pump should dose the fluid. This value can be negative. In that case the pump aspirates the fluid.
            </Description>
            <DataType>
                <DataTypeIdentifier>ValueWithUnit</DataTypeIdentifier>
            </DataType>
        </Parameter>
        <Response>
            <Identifier>Success</Identifier>
            <DisplayName>Success</DisplayName>
            <Description>A boolean value where false means that the dosage failed and true meaning the dosage was finished properly.</Description>
            <DataType>
                <Basic>Boolean</Basic>
            </DataType>
        </Response>
        <StandardExecutionErrors>
            <StandardExecutionErrorIdentifier>DosageFinishedUnexpectedly</StandardExecutionErrorIdentifier>
        </StandardExecutionErrors>
    </Command>
    <Command>
        <Identifier>GenerateFlow</Identifier>
        <DisplayName>Generate Flow</DisplayName>
        <Description>
            Generate a continous flow with the given flow rate. Dosing continues until it gets stopped manually by calling StopDosage or until the pusher reached one of its limits.
        </Description>
        <Observable>Yes</Observable>
        <Parameter>
            <Identifier>FlowRate</Identifier>
            <DisplayName>Flow Rate</DisplayName>
            <Description>
                The flow rate at which the pump should dose the fluid. This value can be negative. In that case the pump aspirates the fluid.
            </Description>
            <DataType>
                <DataTypeIdentifier>ValueWithUnit</DataTypeIdentifier>
            </DataType>
        </Parameter>
        <Response>
            <Identifier>Success</Identifier>
            <DisplayName>Success</DisplayName>
            <Description>A boolean value where false means that the dosage failed and true meaning the dosage was finished properly.</Description>
            <DataType>
                <Basic>Boolean</Basic>
            </DataType>
        </Response>
        <IntermediateResponse>
            <Identifier>Test</Identifier>
            <DisplayName>Test</DisplayName>
            <Description>Test</Description>
            <DataType>
                <Basic>String</Basic>
            </DataType>
        </IntermediateResponse>
        <StandardExecutionErrors>
            <StandardExecutionErrorIdentifier>DosageFinishedUnexpectedly</StandardExecutionErrorIdentifier>
        </StandardExecutionErrors>
    </Command>
    <Command>
        <Identifier>StopDosage</Identifier>
        <DisplayName>Stop Dosage</DisplayName>
        <Description>Stops a currently running dosage immediately.</Description>
        <Observable>No</Observable>
        <Response>
            <Identifier>Success</Identifier>
            <DisplayName>Success</DisplayName>
            <Description>A boolean value where false means that stopping the dosage failed and true meaning the dosage was stopped properly.</Description>
            <DataType>
                <Basic>Boolean</Basic>
            </DataType>
        </Response>
    </Command>

    <!-- Properties -->
    <Property>
        <Identifier>MaxSyringeFillLevel</Identifier>
        <DisplayName>Maximum Syringe Fill Level</DisplayName>
        <Description>The maximum amount of fluid that the syringe can hold.</Description>
        <DataType>
            <DataTypeIdentifier>ValueWithUnit</DataTypeIdentifier>
        </DataType>
        <Observable>No</Observable>
    </Property>
    <Property>
        <Identifier>SyringeFillLevel</Identifier>
        <DisplayName>Syringe Fill Level</DisplayName>
        <Description>The current amount of fluid left in the syringe.</Description>
        <DataType>
            <DataTypeIdentifier>ValueWithUnit</DataTypeIdentifier>
        </DataType>
        <Observable>Yes</Observable>
    </Property>
    <Property>
        <Identifier>MaxFlowRate</Identifier>
        <DisplayName>Maximum Flow Rate</DisplayName>
        <Description>The maximum value of the flow rate at which this pump can dose a fluid.</Description>
        <DataType>
            <DataTypeIdentifier>ValueWithUnit</DataTypeIdentifier>
        </DataType>
        <Observable>No</Observable>
    </Property>
    <Property>
        <Identifier>MinFlowRate</Identifier>
        <DisplayName>Minimum Flow Rate</DisplayName>
        <Description>The minimum value of the flow rate at which this pump can dose a fluid.</Description>
        <DataType>
            <DataTypeIdentifier>ValueWithUnit</DataTypeIdentifier>
        </DataType>
        <Observable>No</Observable>
    </Property>
    <Property>
        <Identifier>FlowRate</Identifier>
        <DisplayName>Flow Rate</DisplayName>
        <Description>The current value of the flow rate. It is 0 if the pump does not dose any fluid.</Description>
        <DataType>
            <DataTypeIdentifier>ValueWithUnit</DataTypeIdentifier>
        </DataType>
        <Observable>Yes</Observable>
    </Property>

    <!-- Errors -->
    <StandardExecutionError>
        <Identifier>DosageFinishedUnexpectedly</Identifier>
        <DisplayName>Dosage Finished Unexpectedly</DisplayName>
        <Description>The dosage could not be finished properly due to an error.</Description>
    </StandardExecutionError>
    <StandardExecutionError>
        <Identifier>FlowRateOutOfRange</Identifier>
        <DisplayName>Flow Rate Out Of Range</DisplayName>
        <Description>The specified flow rate is not in the range bewteen MaxFlowRate and MinFlowRate for this pump.</Description>
    </StandardExecutionError>
    <StandardExecutionError>
        <Identifier>RequestedFillLevelOutOfRange</Identifier>
        <DisplayName>Requested Fill Level Out Of Range</DisplayName>
        <Description>The fill level requested in SetFillLevel is greater than MaxSyringeFillLevel or less than 0.</Description>
    </StandardExecutionError>

    <!-- Custom Data Types -->
    <DataTypeDefinition>
        <Identifier>ValueWithUnit</Identifier>
        <DisplayName>Value with Unit</DisplayName>
        <Description>Holds a value (e.g. flow rate or fill level) and its unit (e.g. ml/h or ml)</Description>
        <DataType>
            <!-- <Structure>
                <Element>
                    <Identifier>Value</Identifier>
                    <DisplayName>Value</DisplayName>
                    <Description />
                    <DataType>
                        <Basic>Real</Basic>
                    </DataType>
                </Element>
                <Element>
                    <Identifier>Unit</Identifier>
                    <DisplayName>Unit</DisplayName>
                    <Description />
                    <DataType>
                        <Basic>String</Basic>
                    </DataType>
                </Element>
            </Structure> -->
            <Basic>Real</Basic>
        </DataType>
    </DataTypeDefinition>
</Feature>
